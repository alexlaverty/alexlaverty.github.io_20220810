window.Stopwatch=class{constructor(){this.prefix="timestamp_",this.maxValue=3e4}start(t=""){const e=Date.now(),i=this.getStorage();i[t]={timestamp:e.toString(),lastTimestamp:0,custom:{}},this.setStorage(i)}stop(t=""){var e=this.timestamp(t);return this.removeByKey(t),e}timestamp(t=""){var e=Date.now()-+(this.getTimeByKey(t)||0);return e>this.maxValue?(this.removeByKey(t),-1):(this.setLastTimestamp(t,e),e)}started=(t="")=>!!this.getTimeByKey(t);setStorage(t){sessionStorage.setItem("stopwatch",JSON.stringify(t))}getStorage(){var t=sessionStorage.getItem("stopwatch");return t?JSON.parse(t):{}}removeByKey(t=""){let e=this.getStorage();delete e[t],this.setStorage(e)}getTimeByKey(t=""){return(this.getStorage()[t]||{}).timestamp}getLastTimestamp(t=""){return+(this.getStorage()[t]||{}).lastTimestamp}setLastTimestamp(t="",e=0){let i=this.getStorage();i[t]&&(i[t].lastTimestamp=e,this.setStorage(i))}setCustomValue(t="",e,i){let s=this.getStorage();s[t]&&(s[t].custom[e]=i,this.setStorage(s))}getCustomValue(t=""){return(this.getStorage()[t]||{}).custom||{}}getActiveTimers(){return Object.keys(this.getStorage())}},window.UserInteractionService=class{endTimer;timers=[];stopwatch;lcp=0;disabled;constructor(t){if(window.UserInteractionService._instance)return window.UserInteractionService._instance;window.UserInteractionService._instance=this;try{const r=document.getElementById("uis-script");var i=r&&(r.src.split("?")[1]||"").split("&").indexOf("disabled=true");if(this.disabled=0<=document.cookie.indexOf("uisDisabled=true")||0<=i,this.disabled)return;if(!window.Stopwatch)return;this.stopwatch=new window.Stopwatch;var s="PerformanceObserver";if(!window[s])return;var n=this.stopwatch.getActiveTimers()||[];(t=[...t=t||[],...n])&&t.length&&window.addEventListener("unload",()=>{t.forEach(t=>{var e=this.stopwatch.getLastTimestamp(t)||0;this.stopwatch.setCustomValue(t,"interruptedAt",e),this.stopwatch.setCustomValue(t,"interrupted",!0),this.end(t)})}),new window[s](t=>{for(var e=t.getEntries(),i=0;i<e.length;i++)-1===e[i].name.indexOf(".nr-data")&&this.resetTimings(e[i])}).observe({entryTypes:["resource","navigation","paint","frame"]}),new window[s](t=>{t=t.getEntries()||[];const i=this.stopwatch.getStorage()||{};t.forEach(e=>{e.hadRecentInput||Object.keys(i).forEach(t=>{i[t].custom.cls=(i[t].custom.cls||0)+e.value})}),this.stopwatch.setStorage(i)}).observe({type:"layout-shift",buffered:!0}),new window[s](t=>{t=t.getEntries()||[];t.length&&(t=t[t.length-1],this.lcp=t.renderTime||t.loadTime)}).observe({type:"largest-contentful-paint",buffered:!0});const o=document;let e;o.addEventListener("click",t=>{for(e=t.target;e.parentElement;)e&&e.attributes.uis&&e.attributes.uis.value&&this.start(e.attributes.uis.value),e=e.parentElement})}catch(t){console.error("err :>> ",t)}}setEndTimer(t=""){return clearTimeout(this.timers[t]),this.timers[t]=setTimeout(()=>{this.end(t)},5e3),this.endTimer}resetTimings(t){const e=this.stopwatch.getActiveTimers()||[];e.forEach(t=>{this.stopwatch.timestamp(t),this.setEndTimer(t)})}end(e=""){if(!this.disabled)try{clearTimeout(this.timers[e]);var i=this.stopwatch.getTimeByKey(e);if(this.stopwatch.started(e)){let t=Math.round(performance.timing.loadEventEnd-performance.timing.navigationStart);i>(performance.timeOrigin||performance.timing.navigationStart)+t&&(t=0);var s=t?t+(performance.timeOrigin||performance.timing.navigationStart)-i:this.stopwatch.getLastTimestamp(e);if(!(s=Math.round(s))||s<0)return void this.stopwatch.stop(e);const o=this.getPerformanceResult(e);o.type="UIS",o.cPagename=this.getPagename();var n=this.stopwatch.getCustomValue(e);n.interrupted&&n.interruptedAt!==s&&(o.userInterrupted=!0),o.sourcePagename=n.sourcePagename,console.group("User action: "+e),console.log("Action time:",s),console.log("Perf metric:",o),console.groupEnd(),window.performanceReport||(window.performanceReport={...o,userActions:{}});var r={userActionTime:window.performanceReport.userActions[e]=s,...o};this.sendToNR&&this.sendToNR(e,r),this.sendToUBE&&this.sendToUBE(e,r),this.stopwatch.stop(e)}}catch(t){console.error(t)}}getPagename(){let t=null;return void 0!==window.utag_data&&void 0!==window.newrelic?t=window.utag_data.page_name:void 0!==window.utag&&void 0!==window.newrelic?t=window.utag.data.page_name:console.warn("newrelic data not set"),t}start(n=""){if(!this.disabled)try{this.stopwatch.start(n),this.stopwatch.setCustomValue(n,"sourcePagename",this.getPagename()),this.stopwatch.setCustomValue(n,"cls",0),this.setEndTimer(n),setTimeout(()=>{const s=()=>{var t,e,i;this.stopwatch.started(n)&&(t=Date.now(),e=this.stopwatch.getLastTimestamp(n)||0,i=this.stopwatch.getTimeByKey(n)-e,console.group(`action "${n}" interrupted by user`),console.info(`no entries since last ${t-i}ms.`),console.info("Last timestamp: "+e),console.groupEnd(),this.stopwatch.setCustomValue(n,"interruptedAt",e),this.stopwatch.setCustomValue(n,"interrupted",!0)),window.removeEventListener("click",s)};window.addEventListener("click",s)})}catch(t){console.error(t)}}timestamp(t=""){this.disabled||this.stopwatch.timestamp(t)}getActiveTimers(){if(!this.disabled)return this.stopwatch.getActiveTimers()}getPerformanceResult(t=""){var e=performance.timing;const i=performance.getEntriesByType("paint");var s=performance.getEntriesByType("first-input")[0],n=performance.timeOrigin||performance.timing.navigationStart;const r={dns:e.domainLookupEnd-e.domainLookupStart,ssl:e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:0,ttfb:e.responseStart-e.requestStart,redirectTime:e.redirectEnd-e.redirectStart,initialConnection:e.connectEnd-e.connectStart,domComplete:e.domComplete-n,domInteractive:e.domInteractive-n,unloadEvent:e.unloadEventEnd-e.unloadEventStart,loadEvent:e.loadEventEnd-n,domContentLoadedEventEnd:e.domContentLoadedEventEnd-n,fid:s?s.processingStart-s.startTime:0,cls:this.stopwatch.getCustomValue(t).cls};n=i.find(t=>"first-paint"===t.name),s=i.find(t=>"first-contentful-paint"===t.name),t=navigator.connection&&navigator.connection.effectiveType,e=e.transferSize;return n&&(r.fp=n.startTime),s&&(r.fcp=s.startTime),e&&(r.transferSize=e),this.lcp&&(r.lcp=this.lcp),Object.keys(r).forEach(t=>{r[t]=+(r[t]||0).toFixed(2)}),t&&(r.connection=t),r}},window.UserInteractionService.prototype.sendToNR=function(t,e){window.newrelic&&window.newrelic.addPageAction(t,e)},window.UserInteractionService.prototype.sendToUBE=function(t,e){if(window.unifiedTrackingFactory&&e){const s=window.unifiedTrackingFactory({stackId:"perf-mock-webui",enableLogging:!0,enableTracking:!1,retryDelays:[200,400,800,1600]});var i={name:t,interrupted:!!e.userInterrupted,time:e.userActionTime},e={cumulativeLayoutShift:e.cls,firstContentfulPaint:e.fcp,firstInputDelay:e.fid,largestContentfulPaint:e.lcp,windowLoad:e.loadEvent};s.trackUserBehavior(t,i),s.trackUserBehavior(t,e)}};