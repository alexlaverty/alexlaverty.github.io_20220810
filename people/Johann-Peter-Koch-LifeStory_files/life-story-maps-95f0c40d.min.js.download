!function(){"use strict";var e=window.getResolution(),o=window.getScreenType();PersonStory&&PersonStory.map&&PersonStory.map.count&&PersonStory.map.count>0&&function(){function t(e){function t(e,o){var t=[];o.eachLayer(function(e){t.push('<li class="conSection" data-lat="'+e.getLatLng().lat+'" data-lon="'+e.getLatLng().lng+'" role="button" tabindex="0">'+e.options.info+"</li>")});var n=t.length,a=1===n?PersonStory.map.text.lifeStoryEvent:PersonStory.map.text.lifeStoryEvents,i=a.replace("{eventCount}",n);$(e).after('<div class="ui-coordinates'+(n<2?" noDisplay":"")+'" id="ui-coordinates"><section class="con hidingEvents"><header class="conHeader conHeaderFlush"><h2 class="conTitle"><button aria-expanded="false" class="link iconAfter iconArrowUpAfter" id="eventsToggle" type="button">'+i+'</button></h2></header><ol class="conSection conList coordinates">'+t.join("")+"</ol></section></div>"),$("#ui-coordinates").on("click","#eventsToggle",function(){var e=$(this);e.toggleClass("iconArrowUpAfter iconArrowDownAfter").closest(".con").toggleClass("showingEvents hidingEvents"),"true"===e.attr("aria-expanded")?e.attr("aria-expanded","false"):e.attr("aria-expanded","true")}).on("click keypress",".conSection",function(e){e.stopPropagation();var o=$(this),t=o.attr("data-lat"),n=o.attr("data-lon");("click"===e.type||"keypress"===e.type&&13===e.which)&&($("#eventsToggle").trigger("click"),s.closePopup().flyTo([t,n],s.getZoom()>13?s.getZoom():13,{animate:!0,duration:2.5}))}),$("#eventsToggle").focus()}function n(e){function t(){!1===i&&(a=s.getZoom(),i=!0,$("#ui-coordinates > .con").hasClass("showingEvents")&&$("#eventsToggle").trigger("click")),clearTimeout(n),n=setTimeout(function(e){if(e!==s.getZoom()){switch(o){case"smart-phone":s.options.minZoom=1;break;case"large-screen":s.options.minZoom=3;break;default:s.options.minZoom=2}switch(e=s.getZoom(),e<=l&&s.setZoom(l),e){case l:$("#zoomControlMinus").addClass("disabled");break;case r:$("#zoomControlPlus").addClass("disabled");break;default:$("#zoomControlPlus").removeClass("disabled"),$("#zoomControlMinus").removeClass("disabled")}}i=!1},250)}var n,a,i=!1,r=s.options.maxZoom,l=s.options.minZoom;s.on("move",t),t();var c=s.getZoom()===r?"disabled":"",u=s.getZoom()===l?"disabled":"";$(e).after('<div class="customZoomControl" id="customZoomControl"><button class="ancBtn ancBtnIconOnly ancBtnT icon iconPlus silver '+c+'" id="zoomControlPlus" type="button">Zoom In</button><button class="ancBtn ancBtnIconOnly ancBtnB icon iconMinus silver '+u+'" id="zoomControlMinus" type="button">Zoom Out</button></div>'),$("#customZoomControl").on("click",".icon",function(){a=s.getZoom(),s.setZoom($(this).hasClass("iconMinus")?a-1:a+1)})}function a(e,a){s=L.map(e,{attributionControl:!0,detectRetina:!0,maxBounds:[[-90,-1/0],[90,1/0]],maxZoom:17,minZoom:"smart-phone"===o?1:"large-screen"===o?3:2,worldCopyJump:!0,zoomControl:!1});var i=(L.mapboxGL({accessToken:m,style:"mapbox://styles/ancestrymapbox/"+c}).addTo(s),{type:"FeatureCollection",features:[],coordinates:[]}),r=null,l=null,u=null,p=L.markerClusterGroup({maxClusterRadius:40}),d="",f="",g=null;a.forEach(function(e){d=e.PinTitle,f=d.substr(0,d.indexOf("<")),d=d.replace(f,"").replace("<br />","").replace("<br />"," &bull;").trim(),i.features.push({type:"Feature",geometry:{type:f,coordinates:[e.Longitude,e.Latitude]},properties:{title:d,description:e.PinDescription||null}}),i.coordinates.push([e.Latitude,e.Longitude]),l=L.icon({iconUrl:"https://a.tiles.mapbox.com/v4/marker/pin-m-"+e.PinIcon+"+"+e.PinColor+".png?access_token="+m,iconRetinaUrl:"https://a.tiles.mapbox.com/v4/marker/pin-m-"+e.PinIcon+"+"+e.PinColor+"@2x.png?access_token="+m,iconSize:[30,70],popupAnchor:[0,-35]}),u=(f?'<h3 class="cardSubTitle">'+f+"</h3>":"")+(d?'<h4 class="cardTitle noTopSpacing">'+d+"</h4>":"")+(e.PinDescription?'<p class="noTopSpacing"><small>'+e.PinDescription+"</small></p>":""),r=L.marker(new L.LatLng(e.Latitude,e.Longitude),{icon:l,info:u}),g=new L.Popup({className:"ancestryPopup",closeButton:!1,maxWidth:400}).setContent(u),r.bindPopup(g),r.on("click",function(){personAnalyticsTrackClick("lifeEventMapPinClick"+f)}),p.addLayer(r)}),s.addLayer(p),t(e,p),s.fitBounds(i.coordinates,{maxZoom:13}),s.on("click",function(){personAnalyticsTrackClick("lifeEventMapClick")}),n(e)}function i(e){function a(e,o,t){var n=e.PinTitle,a=n.substr(0,n.indexOf("<")),i=a;n=n.replace(a,"").replace("<br />","").replace("<br />"," &bull;").trim();var s='<h5 class="cardSubtitle">'+i+'</h5><h6 class="cardTitle">'+n+"</h6><p>"+e.PinDescription+"</p>",r=L.marker(new L.LatLng(o,t),{alt:n,icon:L.mapbox.marker.icon({"marker-symbol":e.PinIcon,"marker-color":e.PinColor,"marker-size":"medium","marker-type":a}),info:s}),l=new L.Popup({className:"markerPopup",closeButton:!1,maxWidth:400}).setContent(s);return r.bindPopup(l).on("click",function(){personAnalyticsTrackClick("lifeEventMapPinClick"+a)}),r}if(L.mapbox.accessToken=m,s=L.mapbox.map(e,null,{maxBounds:[[-90,-1/0],[90,1/0]],maxZoom:17,minZoom:"smart-phone"===o?1:"large-screen"===o?3:2,tileLayer:{format:"jpg80",noWrap:!1,reuseTiles:!0},worldCopyJump:!0,zoomControl:!1}),s.addLayer(L.mapbox.styleLayer("mapbox://styles/ancestrymapbox/"+c)),s.on("click",function(){personAnalyticsTrackClick("lifeEventMapClick")}),"FigureLifeEvents"===r){var i=new L.MarkerClusterGroup({maxClusterRadius:40});PersonStory.map.lifeEvents.data[0].LongLatList.forEach(function(e){var o=a(e,e.Latitude,e.Longitude);i.addLayer(o)}),s.addLayer(i).fitBounds(i.getBounds()),s.getZoom()>13&&s.setZoom(PersonStory.map.lifeEvents.data[0].ZoomLevel),t(e,i)}else{var l=PersonStory.timeline.events[r].EventMapMapData,u=a(l,l.CenterLatitude,l.CenterLongitude);s.setView([l.CenterLatitude,l.CenterLongitude],l.ZoomLevel),u.addTo(s)}L.control.attribution().addTo(s).addAttribution(),n(e)}var s=null,r=e.currentTarget.id.replace("showMapModal-","");window.ui.modal('<div class="mapLifeEvents" id="mapLifeEvents"></div>',{onClose:function(){s.remove(),$("#ui-coordinates").remove(),$("#customZoomControl").remove()},onOpen:function(e){function o(e,t){window[e.key]?e.sub?window[e.key][e.sub]?t():setTimeout(function(){document.getElementById("modal")&&o({key:e.key,sub:e.sub},t)},1):t():setTimeout(function(){document.getElementById("modal")&&o({key:e.key,sub:e.sub},t)},1)}function t(){if(mapboxgl.supported()){var o=null;"FigureLifeEvents"===r?o=PersonStory.map.lifeEvents.data[0].LongLatList:(o=[PersonStory.timeline.events[r].EventMapMapData],o[0].Latitude=o[0].CenterLatitude,o[0].Longitude=o[0].CenterLongitude),a(e.element,o)}else i(e.element)}e.content.classList.add("fullScreenMap"),setTimeout(function(){o({key:"L",sub:"mapbox"+(mapboxgl.supported()?"GL":"")},function(){o({key:"L",sub:"markerClusterGroup"},function(){t()})})},1)},open:!0,useCustomPadding:!0,width:"100%"})}function n(){function n(n,a,i){var s,r={maxZoom:12,minZoom:3,type:"FeatureCollection",features:function(e,o){function t(e,o,t){var a=e.PinTitle,i=a.replace("<br />",":").replace("<br />"," &bull;").replace("<br />",",").trim(),s={type:"Feature",properties:{markerTitle:i,markerSymbol:e.PinIcon,markerColor:e.PinColor,markerType:e.PinTitle.substr(0,e.PinTitle.indexOf("<"))},geometry:{type:"Point",coordinates:[o,t]}};n.push(s)}var n=[];return"lifeEvents"===o?e.forEach(function(e){t(e,e.Longitude,e.Latitude)}):t(e,e.CenterLongitude,e.CenterLatitude),n}(n,a)},l="lifeEvents"===a?750:710;"smart-phone-portrait"===o?(l="lifeEvents"===a?375:355,s=.45*l):s="smart-phone"===o?.4*l:.35*l;var u=[l,parseInt(s)],f=geoViewport.viewport(geojsonExtent(r),u,.55,7),g=f.zoom||n.ZoomLevel;(f.zoom||"smart-phone-portrait"===o)&&(g-=1),g>7&&(g=7),g<1&&(g=.55);var v=[],b=[];r.features.forEach(function(e){b.push("pin-m-"+e.properties.markerSymbol+"+"+e.properties.markerColor+"("+e.geometry.coordinates.join(",")+")"),v.push(e.properties.markerTitle)}),v=v.join("; ");var y=d+"styles/v1/"+p+"/"+c+"/static/"+b.join(",")+"/"+f.center.join(",")+","+g+"/"+u.join("x")+("not-retina"===e?"":"@2x")+"?access_token="+m,L=document.querySelector("#map"+i);L&&(L.classList.remove("loading"),L.innerHTML='<button class="link showMapModal photo" id="showMapModal-'+i+'" type="button"><img alt= "'+PersonStory.text.showMap+'" class="staticMap" src= "'+y+'" /></button><figcaption class="hideVisually">'+v+"</figcaption>"),document.querySelector("#showMapModal-"+i)&&document.querySelector("#showMapModal-"+i).addEventListener("click",t)}PersonStory.map.lifeEvents&&PersonStory.map.lifeEvents.show&&PersonStory.map.lifeEvents.data[0]&&PersonStory.map.lifeEvents.data[0].LongLatList&&n(PersonStory.map.lifeEvents.data[0].LongLatList,"lifeEvents","FigureLifeEvents"),PersonStory.timeline&&PersonStory.timeline.events&&PersonStory.timeline.events.forEach(function(e,o){e.EventMapMapData&&n(e.EventMapMapData,"lifeEvent",o)})}function a(e,o){function t(){o&&(o(),a.onload=a.onreadystatechange=null,o=null)}var n=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.onload=t,a.onreadystatechange=function(){"complete"===this.readyState&&t()},a.src=e,n.appendChild(a)}function i(e){var o,t=document.head;e.forEach(function(e){o=document.createElement("link"),o.href=e,o.rel="stylesheet",t.appendChild(o)})}function s(){function e(){i([d+"mapbox.js/plugins/leaflet-markercluster/v1.0.0/MarkerCluster.css",d+"mapbox.js/plugins/leaflet-markercluster/v1.0.0/MarkerCluster.Default.css"]),a(d+"mapbox.js/plugins/leaflet-markercluster/v1.0.0/leaflet.markercluster.js")}mapboxgl.supported()?(i([window.PersonStory.map.assetsGL.css[0],d+"mapbox-gl-js/v1.10.1/mapbox-gl.css"]),a(window.PersonStory.map.assetsGL.js[0],function(){a(d+"mapbox-gl-js/v1.10.1/mapbox-gl.js",function(){a(window.PersonStory.map.assetsGL.js[1],e)})})):(i([d+"mapbox.js/v3.2.1/mapbox.css"]),a(d+"mapbox.js/v3.2.1/mapbox.js",e))}var r,l,c,u=document.documentElement.lang,p="ancestrymapbox",m="pk.eyJ1IjoiYW5jZXN0cnltYXBib3giLCJhIjoiNllqcGhKYyJ9.p9QKjx4kc2E_55jLTmDw0Q",d="https://api.mapbox.com/";switch(u.substring(0,u.length-3)){case"es":c="ckbjv21pk05gq1iqthzfclvga";break;case"de":c="ckbjv4qjh05ju1iocm3g7kgvq";break;case"fr":c="ckbjv4kem03pv1it4kxwq7yt7";break;default:c="ckbjuweku05bi1iocuppqmfoq"}"undefined"==typeof mapboxgl?(a(d+"mapbox.js/plugins/geo-viewport/v0.1.1/geo-viewport.js",function(){a(d+"mapbox.js/plugins/geojson-extent/v0.0.1/geojson-extent.js",n)}),a(d+"mapbox-gl-js/plugins/mapbox-gl-supported/v1.4.1/mapbox-gl-supported.js",s)):n(),window.addEventListener("resize",window.ui.debounce(function(){r=window.getResolution(),l=window.getScreenType(),e!==r&&(e=r,n()),o!==l&&(o=l,n())},500))}()}();
//# sourceMappingURL=life-story-maps-95f0c40d.min.js.map